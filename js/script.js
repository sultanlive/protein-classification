var ec_ready,go_ready;let ecPDBColorLists=[],correspondingPDB=null,schemes={},representations={},pdbView=null,currentlyHasEnzymePrediction=!1;const NO_PDB_STRUCTURE_SENTINEL="no_pdb_structure";var ecNames;let goModel,goParenthood=null,transitiveGoParenthood={"GO:0008150":new Set(["GO:0008150"]),"GO:0003674":new Set(["GO:0003674"]),"GO:0005575":new Set(["GO:0005575"])},goNames=null;const GO_DECISION_THRESHOLD=.339991183677139;let vocabList=[],vocabLookup={};const KERNEL_SIZE=91;let kernel,ecModel;var b;let waitDoneTypingTimeout=null;const AMINO_ACID_VOCABULARY=["A","C","D","E","F","G","H","I","K","L","M","N","P","Q","R","S","T","V","W","Y"],EC_DECISION_THRESHOLD=.01;enableCancellablePromises();let currentLoadingPromise=Promise.resolve();var ProtVista=require("ProtVista");function isInMobileBrowser(){var e,o=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(o=!0),o}function preventScrolling(e){var o=null;"mousewheel"==e.type?o=-1*e.wheelDelta:"DOMMouseScroll"==e.type&&(o=40*e.detail),o&&(e.preventDefault(),$(this).scrollTop(o+$(this).scrollTop()))}function loadPDB(e){return $("#pdb_unavailable").hide(),pdbMainContainer=$("#pdb_main_container"),preventScrollingEl=document.getElementById("pdb_view"),preventScrollingEl.addEventListener("mousewheel",preventScrolling,{passive:!1}),preventScrollingEl.addEventListener("DOMMouseScroll",preventScrolling,{passive:!1}),pdbView||(pdbView=new NGL.Stage("pdb_view",{backgroundColor:"white"})),pdbView.removeAllComponents(),pdbView.loadFile("rcsb://"+e).then((function(e){drawPredictions(),pdbView.autoView(),document.getElementById("pdb_view").onclick=function(){pdbView.setSpin(!1)},document.getElementById("pdb_view").onmousedown=function(){pdbView.setSpin(!1)},pdbView.setSpin(!0)})).then((e=>{pdbMainContainer.show()}))}function addRepresentation(e){residuesToColors=ecPDBColorLists[e];let o=NGL.ColormakerRegistry.addScheme((function(e){this.atomColor=function(e){return residuesToColors[e.residueIndex-e.chainStore.residueOffset[e.chainIndex]]}}),"scheme_"+e);schemes[e]=o,letter=pdbView.compList[0].structure.chainStore.getChainname(0);let t=pdbView.compList[0].addRepresentation("cartoon",{color:o,sele:":"+letter});representations[e]=t}function highlighter(e){if("no_pdb_structure"!=correspondingPDB){for(i in ecPDBColorLists)representations[i].setVisibility(!1);representations[e].setVisibility(!0)}}function drawPredictions(){for(i in letter=pdbView.compList[0].structure.chainStore.getChainname(0),ecPDBColorLists)addRepresentation(i);pdbView.autoView(),highlighter(0)}function movingAverage(e,o){console.assert(o>2);let t=(o-1)/2,n=[];for(let o=0;o<e.length;o++){let r=Math.max(0,o-t),i=Math.min(e.length,o+t),a=e.slice(r,i).reduce((function(e,o){return e+o}));n.push(a)}return n}function getMaxOfArray(e){return Math.max.apply(null,e)}function sanitizeInput(e){let o=e.toUpperCase().replace(/>(.*)\n/,"").replace(/\s/g,"").replace(/\*$/,"");return o.match(/[^A-Z]/)?new Error("Only one sequence (and one header line) are allowed; check for punctuation."):o}function getInputs(e){e=e.split("");let o=[];for(let t in e)o.push(AMINO_ACID_VOCABULARY.indexOf(e[t]));let t=tf.tensor1d(o,dtype="int32"),n=tf.oneHot(t,AMINO_ACID_VOCABULARY.length),r=tf.tensor1d([e.length],dtype="int32");return n=n.expandDims(),n=tf.cast(n,"float32"),[r,n]}function parseECVocab(e){vocabList=[],vocabLookup={};let o=e.split("\n");for(let e in o){let t=o[e].split("\t");"vocab_item"!=t[0]&&(vocabList.push(t[0]),vocabLookup[t[0]]=vocabList.length-1)}}function loadECMetadata(){let e=$.ajax({url:"./vocabs/EC.tsv",type:"GET",dataType:"text",mimeType:"text/plain",success:parseECVocab}),o=$.getJSON("./ec_names.json",(function(e){ecNames=e}));return Promise.all([e,o])}async function performECInference(e){if(isInMobileBrowser())throw Error("Not supported in mobile browser.");console.log("Starting EC inference");let o=ecModel.execute(getInputs(e),["Sigmoid","set_padding_to_sentinel_2/Select"]),t=o[0],n=t.squeeze().topk(40),r=o[1],a=await n.values.array(),s=await n.indices.array(),l=await tf.greater(t,tf.scalar(.01)).array();for(i in l=l[0],l)if(l[i]){parts=vocabList[i].split(".");for(var c=1;c<parts.length;c++)c==parts.length-1|"-"!=parts[c+1]&&(parentalEC=parts.slice(0,c).concat(Array(parts.length-c).fill("-")),parentalEC=parentalEC.join("."),l[vocabLookup[parentalEC]]=0)}for(i in s)l[s[i]]||(a[i]=0);b=a,l=tf.tensor1d(l).expandDims(0);let d=tf.cast(l,"int32").sum(),p=await tf.matMul(r.squeeze(),kernel);if(d>1&0){let e=p.mul(l).clipByValue(0,1e8).sum(1,keepDims=!0);p=await p.mul(d).sub(e)}return[a,s,await p.gather(n.indices,axis=1).transpose().array()]}function get_color_from_value(e){return e<.5?(proportion=2*e,start=[255,255,255],end=[180,180,180]):(proportion=2*(e-.5),start=[180,180,180],end=[0,255,0]),out=[Math.round(start[0]*(1-proportion)+end[0]*proportion),Math.round(start[1]*(1-proportion)+end[1]*proportion),Math.round(start[2]*(1-proportion)+end[2]*proportion)],out}function getSingleOutput(e,o,t,n){let r=0,i=0,a=[];representationColorList=[];let s=getMaxOfArray(t=movingAverage(t,91));for(cIndex in fname="<div class='large_pdb_controls_entry_contents'><a href='https://enzyme.expasy.org/EC/"+vocabList[e].split(":")[1]+"' class='top-figure-link' target='_blank'>"+vocabList[e]+"</a>: "+ecNames[vocabList[e].replace("EC:","")]+"</div>",n){let e=t[cIndex];e=Math.max(e,0)/s,diff=Math.abs(e-r);let o=get_color_from_value(e);(diff>.01||cIndex==n.length-1)&&(a.push(make_feature(fname,o,i,cIndex)),i=parseInt(cIndex)+1,r=e),representationColorList.push(getDecimalColor(o))}return[a,representationColorList,fname]}load(),tf.disableDeprecationWarnings(),DEFAULT_SEQUENCE_PLACEHOLDER_TEXT="Type your sequence here";var rgbToHex=function(e){var o=Number(e).toString(16);return o.length<2&&(o="0"+o),o};function getDecimalColor(e){return Math.round(256*Math.round(e[0])*256+256*Math.round(e[1])+Math.round(e[2]))}var g,nodes,fullColorHex=function(e,o,t){return"#"+rgbToHex(e)+rgbToHex(o)+rgbToHex(t)};function make_feature(e,o,t,n){return hexcolor=fullColorHex(o[0],o[1],o[2]),feature={type:e,category:"Predictions",begin:t,end:n,color:hexcolor},feature}function generateECOutput(e,o,t,n,r){for(var i in allFeatures=[],featureNames=[],predictedSomething=!1,ecPDBColorLists=[],e)if(e[i]>t){predictedSomething=!0;let t=e[i],a=r.split(""),s=o[i];[features,representationColorList,fname]=getSingleOutput(n[i],t,s,a),allFeatures.push(...features),ecPDBColorLists.push(representationColorList),featureNames.push(fname)}if(currentlyHasEnzymePrediction=predictedSomething,predictedSomething){for(fn in htmlOption="",featureNames)featureName=featureNames[fn],0==fn?selected="checked":selected="",htmlOption+="<div class='large_pdb_controls_entry'><input type='radio' "+selected+" id='rad"+fn+"' name='repr' class='radiolabel' onclick='highlighter("+fn+")' /><label for='rad"+fn+"'>"+featureName+"</label></div>";$("#activation_options").html(htmlOption);var a=document.getElementById("protvista");new ProtVista({el:a,uniprotacc:"P05067",defaultSources:!1,customDataSource:{url:"./data/externalFeatures_",source:"myLab",useExtension:!0,stuff:{sequence:r,features:allFeatures}}})}$("#protvista .up_pftv_track-header").each((function(e){$(this).mouseover((function(){highlighter(e)}))})),$("#protvista .up_pftv_track").each((function(e){$(this).mouseover((function(){highlighter(e)}))})),setTrackHighlightOpacityHandlers(),setInitialTrackHighlightToFirst(),removeHyperLinkForProtvistaCredits(),$(".up_pftv_track-header").removeAttr("title"),$("#ec_container>div>div>div>.up_pftv_aaviewer").append($("<div style='text-align: center;'></div>").text("Amino acid index"))}function setInitialTrackHighlightToFirst(){$(".up_pftv_track-header:first").css("font-weight",500).next().css("opacity",1)}function resetTrackHighlightOpacity(){$("#protvista .up_pftv_track-header").css("font-weight","unset").next().css("opacity",.5)}function setTrackHighlightOpacityHandlers(){$("#protvista .up_pftv_track-header").mouseover((e=>resetTrackHighlightOpacity())).mouseover((e=>$(e.currentTarget).css("font-weight",500))).mouseover((e=>$(e.currentTarget).next().css("opacity",1))),$("#protvista .up_pftv_track").mouseover((e=>resetTrackHighlightOpacity())).mouseover((e=>$(e.currentTarget).css("opacity",1))).mouseover((e=>$(e.currentTarget).prev().css("font-weight",500)))}async function makeECPrediction(e){let[o,t,n]=await performECInference(e);generateECOutput(o,n,.01,t,e),$("#ec_loader").hide(),$("#enzyme_stuff").show(),switchToAppropriateViewMode(),$("#go_content_container").hide(),$("#go_content").show(),$("#go_loader").show(),setTimeout((o=>makeGOPrediction(e)),1)}function hideLoaders(){$("#ec_loader").hide(),$("#go_loader").hide()}function hideContent(){$("#enzyme_stuff").hide(),$("#go_container").hide()}function hideContentShowLoaders(){$("#protvista").hide(),$("#pdb_main_container").hide(),$("#go_content_container").hide(),$("#enzyme_stuff").show(),$("#go_container").show(),$("#ec_loader").show(),$("#go_loader").show()}function hideContentShowError(e){$("#input_seq_error_cont").show(),$("#input_seq_error_cont").html(e),hideContent()}function waitTilDoneTypingThenMakePrediction(e){e.keyCode>=9&&e.keyCode<=45||(clearTimeout(waitDoneTypingTimeout),waitDoneTypingTimeout=setTimeout((function(){customInputSeq()}),200))}function getInputStringAndRenderErrors(){if(inputSequence=document.getElementById("input_seq").value,!inputSequence)return hideLoaders(),hideContent(),Error("No input string");let e=sanitizeInput(inputSequence);if(e instanceof Error)hideContentShowError(e.toString());else if(e.length<=40)return hideContentShowError("Please enter a sequence of more than 40 amino acids for prediction."),Error("Input string too short");return e}function startPrediction(e){$("#input_seq_error_cont").hide(),gtag("event","input_sequence",{event_category:"infer"}),makeECPrediction(e)}function loadPrecomputedExample(e){return jqXHRPromise=$.getJSON(e,(function(e){topkScores=e.EC.topkScores,residueInfoForTopk=e.EC.residueInfoForTopk,threshold=e.EC.threshold,indices=e.EC.indices,input=e.EC.input,generateECOutput(topkScores,residueInfoForTopk,threshold,indices,input),topkScores=e.GO.topkScores,threshold=e.GO.threshold,indices=e.GO.indices,generateGOOutput(topkScores,threshold,indices)})),vanillaPromise=Promise.resolve(jqXHRPromise),vanillaPromise}function showHideForCustomInputSeq(){pdbViewIsLarge()&&switchToSummaryView(),$(".eg_selected").removeClass("eg_selected"),$("#yourseq").addClass("eg_selected"),$("#protein_description_container").hide(),hideContentShowLoaders()}function waitFor(e){return new Promise((function(o,t){!function e(t,n){$(t).length?o($(t)):setTimeout((function(){e(t,n)}),n)}(e,200)}))}function pdbViewIsLarge(){return $("#pdb_view").hasClass("pdb_large_viewer")}function goViewIsLarge(){return $("#cy").hasClass("cy_large_viewer")}function switchToAppropriateViewMode(){pdbViewIsLarge()&&switchToPDBView(),goViewIsLarge()&&switchToGOView(),pdbViewIsLarge()||goViewIsLarge()||switchToSummaryView()}function clearInputSeq(){$("#input_seq").val("")}function customInputSeq(){ec_ready=!1,go_ready=!1,correspondingPDB="no_pdb_structure",showHideForCustomInputSeq(),isInMobileBrowser()?hideContentShowError("Inference for custom sequences isn't supported in mobile browsers."):loadDemo(null,null,null,null).then((e=>getInputStringAndRenderErrors())).then((e=>{e instanceof Error||(hideContentShowLoaders(),startPrediction(e))})).then((e=>$("#pdb_unavailable").show()))}function enableCancellablePromises(){Promise.config({cancellation:!0})}function loadDemo(e,o,t,n,r){if(n==correspondingPDB)return Promise.resolve(switchToSummaryView());enableCancellablePromises(),currentLoadingPromise.cancel(),hideContentShowLoaders();let i=e?waitFor("#input_seq").then((o=>o.val(e))):Promise.resolve(),a=waitFor("#protein_description_contents").then((e=>e.html(o))),s=o?waitFor("#protein_description_container").then((e=>e.show())):Promise.resolve(),l=waitFor("#protein_more_info_link").then((e=>e.attr("href",t))).then((e=>e.show())),c=waitFor("#pdb_unavailable").then((e=>e.hide())),d=r?loadPrecomputedExample(r):Promise.resolve(),p=waitFor("#input_seq_error_cont").then((e=>e.hide()));return currentLoadingPromise=Promise.all([i,a,s,l,c,d,p]),n?(correspondingPDB=n,currentLoadingPromise=currentLoadingPromise.then((e=>loadPDB(n)))):correspondingPDB="no_pdb_structure",currentLoadingPromise=currentLoadingPromise.then((e=>switchToSummaryView())),currentLoadingPromise}function markExampleAsHighlighted(e){$(".eg_selected").removeClass("eg_selected"),$(".arrow_box").removeClass("arrow_box"),$(e.currentTarget).addClass("eg_selected"),$(e.currentTarget).addClass("arrow_box")}function loadDemoHeme(){inputSeqContents=">sp|P69905|HBA_HUMAN Hemoglobin subunit alpha OS=Homo sapiens OX=9606 GN=HBA1 PE=1 SV=2\nMVLSPADKTNVKAAWGKVGAHAGEYGAEALERMFLSFPTTKTYFPHFDLSHGSAQVKGHGKKVADALTNAVAHVDDMPNALSALSDLHAHKLRVDPVNFKLLSHCLLVTLAAHLPAEFTP\nAVHASLDKFLASVSTVLTSKYR",proteinDescription="<b>Nonenzyme.</b> Involved in oxygen transport.",proteinMoreInfoLink="https://www.uniprot.org/uniprot/P69905",loadDemo(inputSeqContents,proteinDescription,proteinMoreInfoLink,null,"precomputed/homo_sapiens_hemoglobin.json")}function loadAmylase(){inputSeqContents=">sp|P04745|AMY1_HUMAN Alpha-amylase 1 OS=Homo sapiens OX=9606 GN=AMY1A PE=1 SV=2\nMKLFWLLFTIGFCWAQYSSNTQQGRTSIVHLFEWRWVDIALECERYLAPKGFGGVQVSPPNENVAIHNPFRPWWERYQPVSYKLCTRSGNEDEFRNMVTRCNNVGVRIYVDAVINHMCGN\nAVSAGTSSTCGSYFNPGSRDFPAVPYSGWDFNDGKCKTGSGDIENYNDATQVRDCRLSGLLDLALGKDYVRSKIAEYMNHLIDIGVAGFRIDASKHMWPGDIKAILDKLHNLNSNWFPEG\nSKPFIYQEVIDLGGEPIKSSDYFGNGRVTEFKYGAKLGTVIRKWNGEKMSYLKNWGEGWGFMPSDRALVFVDNHDNQRGHGAGGASILTFWDARLYKMAVGFMLAHPYGFTRVMSSYRWP\nRYFENGKDVNDWVGPPNDNGVTKEVTINPDTTCGNDWVCEHRWRQIRNMVNFRNVVDGQPFTNWYDNGSNQVAFGRGNRGFIVFNNDDWTFSLTLQTGLPAGTYCDVISGDKINGNCTGI\nKIYVSDDGKAHFSISNSAEDPFIAIHAESKL",proteinDescription="<b>Single-function enzyme</b>. Found chiefly in saliva and pancreatic fluid, that converts starch and glycogen into simple sugars.",proteinMoreInfoLink="https://www.uniprot.org/uniprot/P04745",loadDemo(inputSeqContents,proteinDescription,proteinMoreInfoLink,"1C8Q","precomputed/homo_sapiens_amylase.json")}function loadDemoEColi(){inputSeqContents=">sp|P00909|TRPC_ECOLI Tryptophan biosynthesis protein TrpCF OS=Escherichia coli (strain K12) OX=83333 GN=trpC PE=1 SV=4\nMMQTVLAKIVADKAIWVEARKQQQPLASFQNEVQPSTRHFYDALQGARTAFILECKKASPSKGVIRDDFDPARIAAIYKHYASAISVLTDEKYFQGSFNFLPIVSQIAPQPILCKDFIID\nPYQIYLARYYQADACLLMLSVLDDDQYRQLAAVAHSLEMGVLTEVSNEEEQERAIALGAKVVGINNRDLRDLSIDLNRTRELAPKLGHNVTVISESGINTYAQVRELSHFANGFLIGSAL\nMAHDDLHAAVRRVLLGENKVCGLTRGQDAKAAYDAGAIYGGLIFVATSPRCVNVEQAQEVMAAAPLQYVGVFRNHDIADVVDKAKVLSLAAVQLHGNEEQLYIDTLREALPAHVAIWKAL\nSVGETLPAREFQHVDKYVLDNGQGGSGQRFDWSLLNGQSLGNVLLAGGLGADNCVEAAQTGCAGLDFNSAVESQPGIKDARLLASVFQTLRAY",proteinDescription="<b>Bifunctional enzyme.</b> Catalyzes steps of tryptophan biosynthetic pathway: an isomerase and a synthase.",proteinMoreInfoLink="https://www.uniprot.org/uniprot/P00909",loadDemo(inputSeqContents,proteinDescription,proteinMoreInfoLink,"1PII","precomputed/ecoli_trpcf.json")}function removeHyperLinkForProtvistaCredits(){protvistaHelpPageLink=$(".up_pftv_credit_container > a"),protvistaHelpPageLink.attr("title",protvistaHelpPageLink.attr("href")),protvistaHelpPageLink.removeAttr("href")}function maybeShowMobileBrowserWarning(){isInMobileBrowser()&&waitFor("#use_desktop_browser").then((e=>e.show()))}function hideContentIfInToolOnlyMode(){new URLSearchParams(window.location.search).has("toolOnly")&&waitFor("d-article").then((e=>e.hide()))}async function loadGOModel(){goModel=await tf.loadGraphModel("https://storage.googleapis.com/brain-genomics-public/research/proteins/tmp/js_smmdl2_cnn_swissprot_go_random_swiss-cnn_for_swissprot_go_random-13901080.3/model.json",{credentials:"same-origin"}),$("#loading_model").hide()}async function loadECModel(){ecModel=await tf.loadGraphModel("https://storage.googleapis.com/brain-genomics-public/research/proteins/tmp/js_smmdl2_cnn_swissprot_ec_random_swiss-cnn_for_swissprot_ec_random-13897742.6/model.json",{credentials:"same-origin"}),kernel=await ecModel.execute(getInputs("AAA"),"logits/kernel")}async function load(){hideContentIfInToolOnlyMode(),maybeShowMobileBrowserWarning(),ecPromise=loadECMetadata(),goPromise=loadGOMetadata(),Promise.all([ecPromise,goPromise]).then((e=>loadDemoEColi())).then((e=>{bindCanvasHover(),$(".magnifying_glass_text").show()})),isInMobileBrowser()||Promise.all([loadECModel(),loadGOModel()]).then((e=>{$("#input_seq").prop("disabled",!1),$("#input_seq").css("background-image","url(edit-icon.svg)")})),$.ready((e=>{configureTooltips()}))}function configureTooltips(){$(document).tooltip({show:{delay:0},tooltipClass:"tooltip"})}function generateGOOutput(e,o,t){let n={};for(var r in topKFiltered=e.filter((e=>e>o)),allLabels=[],topKFiltered){let e=goVocab[t[r]];allLabels.push(e)}for(var r in parentNodesToInclude=missingParentNodes(allLabels),e)if(e[r]>o||parentNodesToInclude.includes(goVocab[t[r]])){let o=e[r];n[goVocab[t[r]]]=o}for(var i in n)for(var a of transitiveGoParenthood[i])n[a]=a in n?Math.max(n[i],n[a]):n[i];drawTopPreds(n),drawGraph(n)}function drawTopPreds(e){goParenthoodFastLookup={};for(const e in goParenthood)goParenthoodFastLookup[e]=new Set(goParenthood[e]);for(var o in candidates=Object.keys(e).filter((o=>isALeafNode(o,Object.keys(e),goParenthoodFastLookup))),sortedCandidates=candidates.sort(((o,t)=>e[t]-e[o])),toPrint=sortedCandidates.filter((o=>e[o]>.339991183677139)),htmlToSet="",toPrint)htmlToSet+="<div><a href=http://amigo.geneontology.org/amigo/term/"+toPrint[o]+" class='top-figure-link' target='_blank'>"+toPrint[o]+"</a>: "+goNames[toPrint[o]]+" </div> ";$("#go_grid").html(htmlToSet)}function missingParentNodes(e){toReturn=e.slice();for(let e=0;e<toReturn.length;e++)for(p in node=toReturn[e],parents=goParenthood[node],parents)parent=parents[p],-1==toReturn.indexOf(parent)&&toReturn.push(parent);return toReturn.slice(e.length)}function isALeafNode(e,o,t){for(var n in o=new Set(o),goParenthood)if(o.has(n)&&t[n].has(e))return!1;return!0}function setCySiblingHighlight(){cy.on("mouseover","node",(function(e){var o=e.target;cy.elements().difference(o.outgoers().union(o.incomers())).not(o).addClass("semitransp"),o.addClass("highlight").outgoers().union(o.incomers()).addClass("highlight")})),cy.on("mouseout","node",(function(e){var o=e.target;cy.elements().removeClass("semitransp"),o.removeClass("highlight").outgoers().union(o.incomers()).removeClass("highlight")}))}function drawGraph(e){nodes=Object.keys(e),nodeElements=[],nodes.forEach((function(o){item={data:{label:goNames[o]+"\n",id:o,value:e[o],labelvalue:goNames[o]+" ("+e[o].toFixed(2)+")"}},nodeElements.push(item)})),nodes.forEach((function(e){e in goParenthood&&(parents=goParenthood[e].filter((e=>goVocab.includes(e))),parents.forEach((function(o){item={data:{source:o,target:e}},nodeElements.push(item)})))})),window.cy=cytoscape({container:document.getElementById("cy"),style:baseCytoscapeStylesheet(),layout:{name:"dagre",nodeDimensionsIncludeLabels:!0},autoungrabify:!0,elements:nodeElements,wheelSensitivity:.3}),cy.$("*").panify(),setCySiblingHighlight(),setCyPanzoom(),cy.fit()}function baseCytoscapeStylesheet(){return cytoscape.stylesheet().selector("node").css({content:"data(label)",color:"black",width:"label",height:"label",spacingFactor:.1,"text-valign":"center",outline:"none",shape:"round-rectangle","text-wrap":"wrap","text-max-width":30,"min-zoomed-font-size":0,"background-color":"mapData(value, 0.339991183677139, 1, #888, #ffdf78)",padding:"5px","text-margin-y":"-8px"}).selector("edge").css({"line-color":"lightgray","arrow-scale":"2","curve-style":"taxi","taxi-direction":"downward","target-arrow-shape":"triangle"}).selector("node, edge").css({"overlay-opacity":0})}function turnOnHoverActionsForCytoscape(){cy.style(cy.style().selector("node.highlight").css({"border-color":"#000","border-width":"1px",content:"data(labelvalue)"}).selector("node.semitransp").css({opacity:"0.1"}).selector("edge.highlight").css({"mid-target-arrow-color":"#FFF"}).selector("edge.semitransp").css({opacity:"0.2"}).update())}function turnOffHoverActionsForCytoscape(){cy.style(baseCytoscapeStylesheet())}function hideCyPanzoom(){$(".cy-panzoom").hide()}function showCyPanzoom(){$(".cy-panzoom").show()}function setCyPanzoom(){cy.panzoom({zoomOnly:!0})}async function makeGOPrediction(e){goModel||isInMobileBrowser()||await loadGOModel();let[o,t]=await performGOInference(e);generateGOOutput(o,.339991183677139,t),$("#go_content_container").show(),$("#go_content").hide(),$("#go_loader").hide(),switchToAppropriateViewMode()}function loadGOMetadata(){return parenthoodPromise=$.getJSON("models/go/go_parenthood.json",(function(e){for(var o in goParenthood=e,goParenthood){var t=[o];for(transitiveGoParenthood[o]=new Set([o]);0!==t.length;)curParent=t.pop(),transitiveGoParenthood[o].add(curParent),curParent in goParenthood&&(toPush=goParenthood[curParent].filter((e=>e!=curParent)),t.push(...toPush))}})),namesPromise=$.getJSON("models/go/go_names.json",(function(e){goNames=e})),vocabPromise=$.getJSON("models/go/go_vocab.json",(function(e){goVocab=e})),Promise.all([parenthoodPromise,namesPromise,vocabPromise])}function getInputs(e){e=e.split("");let o=[];for(let t in e)o.push(AMINO_ACID_VOCABULARY.indexOf(e[t]));let t=tf.tensor1d(o,dtype="int32"),n=tf.oneHot(t,AMINO_ACID_VOCABULARY.length),r=tf.tensor1d([e.length],dtype="int32");return n=n.expandDims(),n=tf.cast(n,"float32"),{sequence_length_placeholder:r,batched_one_hot_sequences_placeholder:n}}async function performGOInference(e){if(isInMobileBrowser())throw Error("Not supported in mobile browser.");let o=goModel.execute(getInputs(e),["Sigmoid"]).squeeze().topk(32102);return[await o.values.array(),await o.indices.array()]}function rerenderPDBAndGO(){pdbView.handleResize(),pdbView.setSpin(!0),cy.resize(),cy.fit()}function turnOnClickToEnterLargeModes(){$("#pdb_view").off("click"),$("#cy").off("click"),$("#pdb_view").click((e=>switchToPDBView())),$("#cy").click((e=>switchToGOView()))}function makePDBSmall(){$("#pdb_view").removeClass("pdb_large_viewer"),$("#pdb_view").addClass("pdb_small_viewer")}function makeGOSmall(){$("#cy").removeClass("cy_large_viewer"),$("#cy").addClass("cy_small_viewer")}function makePDBAndGOSmall(){makePDBSmall(),makeGOSmall()}function disableInteractionsForSummaryView(){cy.zoomingEnabled(!1),pdbView.mouseControls.remove("scroll"),pdbView.mouseControls.remove("drag")}function disableNGLTooltip(){pdbView.mouseControls.remove("hoverPick")}function enableNGLTooltip(){pdbView.mouseControls.add("hoverPick",NGL.MouseActions.tooltipPick)}function enableInteractions(){cy.zoomingEnabled(!0),pdbView.mouseControls.add("scroll",NGL.MouseActions.zoomScroll),pdbView.mouseControls.add("drag",NGL.MouseActions.rotateDrag)}function toggleHelpButtonText(e){e.text().match(/more/)?e.text("Less"):e.text("Learn more")}function toggleSummaryHelpText(e,o){e.hasClass("help_visible")?(e.animate({width:"88px"},"slow",(o=>toggleHelpButtonText(e))),o.slideUp()):(e.animate({width:"100%"},"slow",(o=>toggleHelpButtonText(e))),o.slideDown()),e.toggleClass("help_visible")}function toggleECSummaryHelpText(){toggleSummaryHelpText($("#learn_more_ec_button"),$("#learn_more_ec_contents"))}function toggleGOSummaryHelpText(){toggleSummaryHelpText($("#learn_more_go_button"),$("#learn_more_go_contents"))}function switchToSummaryView(){makePDBAndGOSmall(),bindCanvasHover(),bindPDBHover(),turnOnClickToEnterLargeModes(),turnOffHoverActionsForCytoscape(),hideCyPanzoom(),hideLoaders(),$(".magnifying_glass_text").show(),$(".return_to_summary_mode_text").hide(),$("#go_grid").show(),$("#go_content_container").show(),$("#go_container").show(),$("#go_color_bar").hide(),currentlyHasEnzymePrediction?($("#enzyme_stuff").show(),"no_pdb_structure"!=correspondingPDB&&$("#pdb_main_container").show(),$("#protvista").show(),$("#ec_go_separator").show(),$("#large_pdb_controls").hide(),$("#large_ec_instructions").hide(),$("#large_go_instructions").hide()):($("#enzyme_stuff").hide(),$("#ec_go_separator").hide()),$("#ec_color_bar").hide(),rerenderPDBAndGO(),disableInteractionsForSummaryView(),disableNGLTooltip()}function switchToPDBView(){currentlyHasEnzymePrediction?($("#protvista").hide(),$("#viewonPDB").hide(),$("#go_container").hide(),$("#ec_loader").hide(),$("#large_pdb_controls").show(),$("#large_ec_instructions").show(),$(".return_to_summary_mode_text").show(),$("#ec_color_bar").show(),$("#pdb_mag").hide(),pdbViewIsLarge()||($("#pdb_view").removeClass("pdb_small_viewer"),$("#pdb_view").addClass("pdb_large_viewer"),pdbView.handleResize(),enableInteractions(),enableNGLTooltip(),loadPDB(correspondingPDB),$(".magnifying_glass_text").hide(),$("#pdb_view").off("click"),rerenderPDBAndGO())):switchToSummaryView()}function switchToGOView(){goViewIsLarge()?console.log("View is already large."):($("#magnify_go").hide(),console.log("Switching to GO view"),$("#cy").removeClass("cy_small_viewer"),$("#cy").addClass("cy_large_viewer"),$("#ec_go_separator").hide(),$("#go_loader").hide(),$("#enzyme_stuff").hide(),$("#view_go_container").hide(),$("#go_grid").hide(),$("#large_go_instructions").show(),$("#go_content_container").show(),$("#unswitch_to_go").show(),$("#go_color_bar").show(),enableInteractions(),turnOnHoverActionsForCytoscape(),showCyPanzoom(),$(".magnifying_glass_text").hide(),$("#cy").off("click"),rerenderPDBAndGO())}function bindCanvasHover(){$("#cy").mouseenter((function(){goViewIsLarge()?$("#magnify_go").hide():$("#magnify_go").show()})),$("#cy").mouseleave((function(){$("#magnify_go").hide()}))}function bindPDBHover(){$("#color_bar_and_pdb_view").mouseenter((function(){pdbViewIsLarge()?$("#pdb_mag").hide():$("#pdb_mag").show()})),$("#color_bar_and_pdb_view").mouseleave((function(){$("#pdb_mag").hide()}))}featureNames=[];